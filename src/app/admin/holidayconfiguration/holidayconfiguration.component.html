<div class="col-12">
  <div class="card" id="main-card">
    <p-toast key="tst"></p-toast>
    <!-- Toolbar -->
    <p-toolbar styleClass="p-mb-4">
      <ng-template pTemplate="left">
        <h4>Holiday Configuration</h4>
      </ng-template>
      <ng-template pTemplate="right">
        <button pButton pRipple label="Add Holiday" id="addHolidayButton"  icon="pi pi-plus" class="p-button-primary p-mr-2"
          (click)="addLeaveDialog()"></button>
      </ng-template>
    </p-toolbar>
    <!--  Add dialog -->
    <p-dialog id="holidayDialog" header="Holiday" [(visible)]="dialog" [modal]="true" showEffect="fade"
      [breakpoints]="{'960px': '70%', '640px': '80%'}" [style]="{width: '70%'}" (onHide)="onClose()">
      <div class="flex flex-column align-items-center justify-content-center">
        <form [formGroup]="fbleave" (ngSubmit)="onSubmit()">
          <div class="grid">
            <div class="col-12 roles-container">
              <div class="p-fluid p-formgrid grid">
                <div class="field col-12 md:col-4">
                  <label>Holiday Title: <sup class="p-error">*</sup>
                  </label>&nbsp; <input pInputText #title id="title" type="text" formControlName="title"
                  alphaOnly [maxlength]="maxLength.title"
                    placeholder="Enter Holiday Title" [ngClass]="{ 'is-invalid ng-dirty': FormControls['title'].touched && FormControls['title'].errors }"/>
                    <div class="flex">
                      <div class="align-left w-60" style="width:70%">
                        <span *ngIf="FormControls['title'].touched && FormControls['title'].invalid">
                          <div class="ng-invalid ng-touched p-error"
                            *ngIf="FormControls['title'].errors?.['required']">
                            Please Enter Title.</div>
                          <div class="ng-invalid ng-touched p-error"
                            *ngIf="FormControls['title'].errors?.['minlength']">
                            Title Min Characters Is 2.</div>
                          <div class="ng-invalid ng-touched p-error" *ngIf="FormControls['title'].errors?.['pattern']">
                            Title Should Contains Only Alphabets.</div>
                        </span>
                      </div>
                      <div class="align-right w-40" style="width:30%; text-align:right;">
                        <small>{{title.value.length}}/{{maxLength.title}}</small>
                      </div>
                    </div>
                  </div>
                  <div class="field col-12 md:col-4">
                    <label>From Date: <sup class="p-error">*</sup></label>&nbsp; 
                    <p-calendar formControlName="fromDate" id="fromDate" placeholder="Select From Date" [showIcon]="true"
                        appendTo="body" [ngClass]="{ 'is-invalid ng-dirty': fbleave.get('fromDate').touched && fbleave.get('fromDate').errors }">
                    </p-calendar>
                    <span *ngIf="fbleave.get('fromDate').touched && fbleave.get('fromDate').invalid">
                        <div class="ng-invalid ng-touched p-error" *ngIf="fbleave.get('fromDate').errors?.['required']">
                            Please Select FromDate.</div>
                        <div *ngIf="fbleave.get('fromDate').touched && fbleave.get('fromDate').errors?.['dateExists']"class="ng-invalid ng-touched p-error">
                            This date is already a holiday.
                        </div>
                    </span>
                </div>
                <div class="field col-12 md:col-4">
                  <label>To Date:</label>&nbsp; <p-calendar formControlName="toDate"  id="toDate" placeholder="Select To Date"
                    [showIcon]="true" appendTo="body"></p-calendar>
                </div>
                <div class="field col-12 md:col-4">
                  <label>Holiday Description: <sup class="p-error">*</sup>
                  </label>&nbsp; <input pInputText id="description" type="text"  id="description" formControlName="description" #description placeholder="Enter Holiday Description"
                  [ngClass]="{ 'is-invalid ng-dirty': FormControls['description'].touched && FormControls['description'].errors }" />
                  <div class="flex">
                    <div class="align-left w-60" style="width:70%">
                      <span *ngIf="FormControls['description'].touched && FormControls['description'].invalid">
                        <div class="ng-invalid ng-touched p-error"
                          *ngIf="FormControls['description'].errors?.['required']">
                          Please Enter Name.</div>
                        <div class="ng-invalid ng-touched p-error"
                          *ngIf="FormControls['description'].errors?.['minlength']">
                          Name Min Characters Is 2.</div>
                        <div class="ng-invalid ng-touched p-error" *ngIf="FormControls['description'].errors?.['pattern']">
                          Name Should Contains Only Alphabets.</div>
                      </span>
                    </div>
                    <div class="align-right w-40" style="width:30%; text-align:right;">
                      <small>{{description.value.length}}/{{maxLength.description}}</small>
                    </div>
                </div>
              </div>
        
                <div class="field col-12 md:col-4">
                  <label class="required">Is Active:</label><br>
                  <p-inputSwitch formControlName="isActive" id="isActive"></p-inputSwitch>
                </div>
                <div class=" col-12 md:col-4 mt-2">
                  <div class=" button-container mt-5">
                    <p-button type="button" label="Add Holiday" id="HolidayDetails-Btn"
                      [disabled]="fbleave.get('title').invalid || fbleave.get('fromDate').invalid || fbleave.get('isActive').invalid || fbleave.get('description').invalid"
                      (click)="addLeaveDetails()" ></p-button>
                  </div>
                </div>
                <!-- FotmArray -->
                <div class="col-12 scrolling_content" formArrayName="leaveDetails">
                  <p-table #dt2 [value]="faleaveDetail().controls" dataKey="id" [rows]="10" [rowHover]="true"
                    *ngIf="ShowleaveDetails" styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm"
                    [paginator]="false" [autoLayout]="true" responsiveLayout="scroll"
                    [rowsPerPageOptions]="[10,25,50]">> <ng-template pTemplate="header">
                      <tr>
                        <th>Holiday Title <sup class="p-error">*</sup>
                        </th>
                        <th>From Date <sup class="p-error">*</sup>
                        </th>
                        <th>To Date </th>
                        <th>Holiday Description <sup class="p-error">*</sup>
                        </th>
                        <th>Is Active </th>

                      </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-leave let-leaveDetailsIndex="rowIndex">
                      <tr [formGroupName]="leaveDetailsIndex">
                        <td class="vertical-align-top">
                          <input pInputText class="form-control" id="FotmArray-title" formControlName="title" placeholder="Holiday Title">
                        </td>
                        <td class="vertical-align-top">
                          <p-calendar formControlName="fromDate" id="FotmArray-fromDate" placeholder="Enter From Date" [showIcon]="true"
                            appendTo="body"></p-calendar>
                        </td>
                        <td class="vertical-align-top">
                          <p-calendar formControlName="toDate"  id="FotmArray-toDate" placeholder="Enter To Date" [showIcon]="true"
                            appendTo="body"></p-calendar>
                        </td>
                        <td class="vertical-align-top">
                          <input pInputText class="form-control" id="FotmArray-description" formControlName="description"
                            placeholder="Enter Holilday Description">
                        </td>
                        <td class="vertical-align-top">
                          <label class="required">Is Active:</label><br>
                          <p-inputSwitch formControlName="isActive" id="description-isActive"></p-inputSwitch>
                        </td>

                        <td *ngIf="fbleave.controls['leaveDetails'].value.length > 1">
                          <i class="pi pi-fw pi-times-circle text-3xl cursor-pointer"
                            *ngIf="!this.faleaveDetail().controls[leaveDetailsIndex].get('id')?.value"
                            (click)="faleaveDetail().removeAt(leaveDetailsIndex)"></i>
                          <i class="pi pi-fw pi-times-circle text-3xl cursor-pointer"
                            *ngIf="this.faleaveDetail().controls[leaveDetailsIndex].get('id')?.value"
                            (click)="faleaveDetail().removeAt(leaveDetailsIndex)"></i>
                        </td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <ng-template pTemplate="footer">
        <div class="col-4" style="float:right">
          <button pButton pRipple type="submit" id="submit-btn" [label]="submitLabel" [disabled]="this.fbleave.get('leaveDetails').value.length === 0 " class="p-button-raised p-button-primary"
            (click)="onSubmit()"></button>
        </div>
      </ng-template>
    </p-dialog>
    <!--  Edit dialog -->
    <p-dialog  id="edit-dialog" header="Holiday" [(visible)]="editDialog" [modal]="true" showEffect="fade"
      [breakpoints]="{'960px': '70%', '640px': '80%'}" [style]="{width: '70%'}" (onHide)="onClose()">
      <div class="flex flex-column align-items-center justify-content-center">
        <form [formGroup]="holidayForm" (ngSubmit)="onSubmit()">
          <div class="grid">
            <div class="col-12 roles-container">
              <div class="p-fluid p-formgrid grid">
                <div class="field col-12 md:col-4">
                  <label>Holiday Title: <sup class="p-error">*</sup>
                  </label>&nbsp; <input pInputText id="edit-title" type="text" formControlName="title"
                    placeholder="Enter Holiday Title" />
                </div>
                <div class="field col-12 md:col-4">
                  <label>From Date: <sup class="p-error">*</sup>
                  </label>&nbsp; <p-calendar formControlName="fromDate" id="edit-fromDate" placeholder="Enter From Date" [showIcon]="true"
                    appendTo="body"></p-calendar>
                </div>
                <div class="field col-12 md:col-4">
                  <label>To Date:</label>&nbsp; <p-calendar [showIcon]="true"  id="edit-toDate" formControlName="toDate"
                    placeholder="Enter To Date" appendTo="body"></p-calendar>
                </div>
                <div class="field col-12 md:col-4">
                  <label>Holiday Description: <sup class="p-error">*</sup>
                  </label>&nbsp; <input pInputText id="edit-description" type="text"formControlName="description"
                    placeholder="Enter Holiday Description" />
                </div>
                <div class="field col-12 md:col-4">
                  <label class="required">Is Active:</label><br>
                  <p-inputSwitch formControlName="isActive" id="edit-isActive"></p-inputSwitch>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <ng-template pTemplate="footer">
        <div class="col-4" style="float:right">
          <button pButton pRipple type="submit" [label]="submitLabel" class="p-button-raised p-button-primary"
            (click)="onSubmit()"></button>
        </div>
      </ng-template>
    </p-dialog>
    <!-- delete dialog -->
<p-dialog id="delete-dialog" header="Delete" [(visible)]="deletedialog" [modal]="true" showEffect="fade"
[breakpoints]="{'960px': '70%', '640px': '80%'}" [style]="{width: '40%'}" (onHide)="deleted()">
  <h5>Are you sure you want to delete...!</h5>
  <ng-template pTemplate="footer">
    <div class="col-4" style="float:right">
      <button pButton pRipple type="submit" label="YES" id="delete-YES-btn"  (click)="deleteHoliday()" class="p-button-raised p-button-primary"></button>
      <button pButton pRipple type="submit" label="NO" id="delete-NO-btn" (click)="deleted()" class="p-button-raised p-button-primary"></button>
    </div>
  </ng-template>
</p-dialog>
    <!-- table -->
    <p-table  id="table" #dtleave [value]="holidays" dataKey="id" [rows]="10" [rowHover]="true" [alwaysShowPaginator]="false"
      styleClass="p-datatable-gridlines p-datatable-striped p-datatable-sm" [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [showCurrentPageReport]="true"
      [globalFilterFields]="globalFilterFields" [autoLayout]="true" responsiveLayout="scroll"
      [rowsPerPageOptions]="[10,25,50]">
      <ng-template pTemplate="caption">
        <div class="flex justify-content-between flex-column sm:flex-row">
          <button pButton label="Clear" class="p-button-outlined mb-2" icon="pi pi-filter-slash"
            (click)="clear(dtleave)"id="clear-btn"></button>
          <div class="field text-center m-0">
            <label>Year:
            </label>
            &nbsp; <p-dropdown [options]="years" id="year-dropdown" placeholder="Select a Year" [(ngModel)]="selectedYear"
              (onChange)="initHoliday()" optionLabel="year"></p-dropdown>
          </div>
          <span class="p-input-icon-left mb-2">
            <i class="pi pi-search"></i>
            <input pInputText type="text" id="search-input" #filter (input)="onGlobalFilter(dtleave, $event)" placeholder="Search Keyword"
              class="w-full" />
          </span>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="width:5px"></th>
          <th *ngFor="let col of headers" [pSortableColumn]="col.header">
            {{col?.label}}
            <p-columnFilter type="text" [field]="col.header" display="menu"></p-columnFilter>
            <p-sortIcon [field]="col.header"></p-sortIcon>
          </th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-leave>
        <tr>
          <td>
            <div class="flex">
            <button pButton pRipple icon="pi pi-pencil" style="padding: 0px;"
              class="p-element p-ripple p-button-text p-button p-component mr-2 " (click)="editHoliday(leave)"></button>
              <button pButton pRipple icon="pi pi-trash" id="delete" 
              class="p-element p-ripple p-button-text p-button p-component col-6 "(click)="Dialog(leave)"></button>
              </div>
          </td>

          <td *ngFor="let col of headers" [ngClass]="col?.field == 'isActive' ? 'text-center' : ''">
            <span
              *ngIf="col?.field != 'createdAt' && col?.field != 'updatedAt' && col?.field != 'fromDate' && col?.field != 'toDate' && col?.field != 'isActive'">{{leave[col.field]}}</span>
            <span
              *ngIf="col?.field == 'createdAt' || col?.field == 'updatedAt' || col?.field == 'fromDate' || col?.field == 'toDate'">
              {{leave[col.field] | date: 'mediumDate' }}
            </span>
            <span *ngIf="col?.field == 'isActive'">
              <p-checkbox name="isActive" value="isActive" [binary]="true" [(ngModel)]="leave[col.field]"
                [disabled]="true">
              </p-checkbox>
            </span>
          </td>

        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td class="md:text-center m-5" colspan="8">No Holidays Found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>